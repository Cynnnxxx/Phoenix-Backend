const { MessageEmbed } = require("discord.js");const User = require("../../../model/user.js");const UserStats = require("../../../model/userstats.js");const Arena = require("../../../model/arena.js");const fs = require("fs");const config = JSON.parse(fs.readFileSync("./Config/config.json").toString());module.exports = {    commandInfo: {        name: "leaderboard",        description: "Shows the leaderboard with kills, wins, KD, and Arena points. (Admin Only)"    },    execute: async (interaction) => {        await interaction.deferReply({ ephemeral: false });        if (!config.moderators.includes(interaction.user.id)) {            return interaction.editReply({ content: "You do not have administrator permissions.", ephemeral: true });        }        try {            const allUsers = await User.find({ banned: false }).lean();            const allStats = await UserStats.find({}).lean();            const allArena = await Arena.find({}).lean();            const statsMap = new Map(allStats.map(s => [s.accountId, s]));            const arenaMap = new Map(allArena.map(a => [a.accountId, a]));            const leaderboardData = [];            for (const user of allUsers) {                const stats = statsMap.get(user.accountId);                const arena = arenaMap.get(user.accountId);                if (!stats) continue;                const totalKills = (stats.solo?.kills || 0) +                                  (stats.duo?.kills || 0) +                                  (stats.trio?.kills || 0) +                                  (stats.squad?.kills || 0) +                                  (stats.ltm?.kills || 0);                const totalWins = (stats.solo?.placetop1 || 0) +                                  (stats.duo?.placetop1 || 0) +                                  (stats.trio?.placetop1 || 0) +                                  (stats.squad?.placetop1 || 0) +                                  (stats.ltm?.wins || 0);                const totalDeaths = (stats.solo?.deaths || 0) +                                   (stats.duo?.deaths || 0) +                                   (stats.trio?.deaths || 0) +                                   (stats.squad?.deaths || 0) +                                   (stats.ltm?.deaths || 0);                const kd = totalDeaths > 0 ? (totalKills / totalDeaths).toFixed(2) : (totalKills > 0 ? totalKills.toFixed(2) : "0.00");                const arenaPoints = arena?.hype || 0;                leaderboardData.push({                    username: user.username,                    accountId: user.accountId,                    kills: totalKills,                    wins: totalWins,                    kd: parseFloat(kd),                    arenaPoints: arenaPoints                });            }            leaderboardData.sort((a, b) => b.kills - a.kills);            const top100 = leaderboardData.slice(0, 100);            const embeds = [];            const playersPerEmbed = 12;            const totalEmbeds = Math.ceil(top100.length / playersPerEmbed);            for (let i = 0; i < totalEmbeds; i++) {                const start = i * playersPerEmbed;                const end = Math.min(start + playersPerEmbed, top100.length);                const playersChunk = top100.slice(start, end);                let leaderboardText = "";                playersChunk.forEach((player, index) => {                    const rank = start + index + 1;                    leaderboardText += `**${rank}.** ${player.username}\n`;                    leaderboardText += `   Kills: ${player.kills} | Wins: ${player.wins} | KD: ${player.kd} | Arena Points: ${player.arenaPoints}\n\n`;                });                const embed = new MessageEmbed()                    .setColor("GOLD")                    .setTitle(i === 0 ? `ğŸ† Leaderboard (Top 100)` : `ğŸ† Leaderboard (Continued)`)                    .setDescription(leaderboardText || "No players found.")                    .setTimestamp()                    .setFooter({                        text: `Pulse â€¢ Page ${i + 1}/${totalEmbeds}`,                        iconURL: "https://i.imgur.com/VKPcwAJ.png"                    });                embeds.push(embed);            }            interaction.editReply({ embeds: embeds });        } catch (error) {            console.error("Error fetching leaderboard:", error);            interaction.editReply({ content: "An error occurred while fetching the leaderboard.", ephemeral: true });        }    }}